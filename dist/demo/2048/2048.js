function Block(){}Block.prototype={creatBlock:function(){function o(){l=Math.floor(4*Math.random()),e=Math.floor(4*Math.random()),game.allBlock[l][e]>1&&o()}var t=Math.random();t=t>.9?4:2;var l,e;o(),game.allBlock[l][e]=t,$("#block_"+l+"_"+e).html('<div class="block block_'+t+" block_p_"+l+"_"+e+'"><div>'),localStorage.setItem("allBlock",JSON.stringify(game.allBlock))},left:function(){game.check()&&game.moveLeft()&&(this.showBlock(),setTimeout(this.creatBlock,200))},up:function(){game.check()&&game.moveUp()&&(this.showBlock(),setTimeout(this.creatBlock,200))},right:function(){game.check()&&game.moveRight()&&(this.showBlock(),setTimeout(this.creatBlock,200))},down:function(){game.check()&&game.moveDown()&&(this.showBlock(),setTimeout(this.creatBlock,200))},restart:function(){$("#block_container div[id^=block_]").html(""),$(".score .score_num span").text(0),game.allBlock=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],game.score=0,localStorage.score=0,$(".chessboard .mask").hide(0),$(".chessboard .game_over").removeClass("goTop"),this.creatBlock(),this.creatBlock()},showBlock:function(){for(var o=0;o<4;o++)for(var t=0;t<4;t++){var l,e=document.getElementById("block_"+o+"_"+t);game.allBlock[o][t]>2048?(l="plus",e.innerHTML=0==game.allBlock[o][t]?"":"<div class='block block_"+l+" block_p_"+o+"_"+t+"'>"+game.allBlock[o][t]+"<div>"):(l=game.allBlock[o][t],e.innerHTML=0==game.allBlock[o][t]?"":"<div class='block block_"+l+" block_p_"+o+"_"+t+"'><div>")}localStorage.score=game.score,$(".score .score_num span").text(game.score),game.best<game.score&&(game.best=game.score,localStorage.best=game.best,$(".best .score_num span").text(game.best))}};var game={allBlock:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],score:0,best:0,check:function(){return!1!==this.canLeft()||!1!==this.canRight()||!1!==this.canUp()||!1!==this.canDown()||($(".chessboard .mask").fadeIn("slow"),$(".chessboard .game_over").addClass("goTop"),!1)},canLeft:function(){for(var o=0;o<4;o++)for(var t=1;t<4;t++)if(0!=this.allBlock[o][t]&&(0==this.allBlock[o][t-1]||this.allBlock[o][t]==this.allBlock[o][t-1]))return!0;return!1},getNextRight:function(o,t){for(var l=t+1;l<4;l++)if(0!=this.allBlock[o][l])return l;return-1},moveLeftOneRow:function(o){for(var t=0;t<3;t++){var l=this.getNextRight(o,t);if(-1==l)break;0==this.allBlock[o][t]?(this.allBlock[o][t]=this.allBlock[o][l],this.allBlock[o][l]=0,t--):this.allBlock[o][t]==this.allBlock[o][l]&&(this.allBlock[o][t]*=2,this.score+=this.allBlock[o][t],this.allBlock[o][l]=0)}},moveLeft:function(){if(this.canLeft()){for(var o=0;o<4;o++)this.moveLeftOneRow(o);return!0}},canRight:function(){for(var o=0;o<4;o++)for(var t=0;t<3;t++)if(0!=this.allBlock[o][t]&&(0==this.allBlock[o][t+1]||this.allBlock[o][t]==this.allBlock[o][t+1]))return!0;return!1},getNextLeft:function(o,t){for(var l=t-1;l>=0;l--)if(0!=this.allBlock[o][l])return l;return-1},moveRightOneRow:function(o){for(var t=3;t>0;t--){var l=this.getNextLeft(o,t);if(-1==l)break;0==this.allBlock[o][t]?(this.allBlock[o][t]=this.allBlock[o][l],this.allBlock[o][l]=0,t++):this.allBlock[o][t]==this.allBlock[o][l]&&(this.allBlock[o][t]*=2,this.score+=this.allBlock[o][t],this.allBlock[o][l]=0)}},moveRight:function(){if(this.canRight()){for(var o=0;o<4;o++)this.moveRightOneRow(o);return!0}},canUp:function(){for(var o=1;o<4;o++)for(var t=0;t<4;t++)if(0!=this.allBlock[o][t]&&(0==this.allBlock[o-1][t]||this.allBlock[o][t]==this.allBlock[o-1][t]))return!0;return!1},getNextDown:function(o,t){for(var l=o+1;l<4;l++)if(0!=this.allBlock[l][t])return l;return-1},moveUpOneCol:function(o){for(var t=0;t<4;t++){var l=this.getNextDown(t,o);if(-1==l)break;0==this.allBlock[t][o]?(this.allBlock[t][o]=this.allBlock[l][o],this.allBlock[l][o]=0,t--):this.allBlock[t][o]==this.allBlock[l][o]&&(this.allBlock[t][o]*=2,this.score+=this.allBlock[t][o],this.allBlock[l][o]=0)}},moveUp:function(){if(this.canUp()){for(var o=0;o<4;o++)this.moveUpOneCol(o);return!0}},canDown:function(){for(var o=0;o<3;o++)for(var t=0;t<4;t++)if(0!=this.allBlock[o][t]&&(0==this.allBlock[o+1][t]||this.allBlock[o][t]==this.allBlock[o+1][t]))return!0;return!1},getNextUp:function(o,t){for(var l=o-1;l>=0;l--)if(0!=this.allBlock[l][t])return l;return-1},moveDownOneCol:function(o){for(var t=3;t>0;t--){var l=this.getNextUp(t,o);if(-1==l)break;0==this.allBlock[t][o]?(this.allBlock[t][o]=this.allBlock[l][o],this.allBlock[l][o]=0,t++):this.allBlock[t][o]==this.allBlock[l][o]&&(this.allBlock[t][o]*=2,this.score+=this.allBlock[t][o],this.allBlock[l][o]=0)}},moveDown:function(){if(this.canDown()){for(var o=0;o<4;o++)this.moveDownOneCol(o);return!0}}},block=new Block;if(localStorage.score>0&&(game.score=Number(localStorage.score),$(".score .score_num span").text(game.score)),localStorage.best&&(game.best=Number(localStorage.best),$(".best .score_num span").text(game.best)),localStorage.allBlock){var allBlockTemp=JSON.parse(localStorage.getItem("allBlock"));game.allBlock=eval(allBlockTemp),block.showBlock()}else block.creatBlock(),block.creatBlock();$(document).on("keydown",function(o){38!==o.keyCode&&40!==o.keyCode||o.preventDefault()}),$(document).on("keyup",function(o){37===o.keyCode&&block.left(),38===o.keyCode&&block.up(),39===o.keyCode&&block.right(),40===o.keyCode&&block.down()}),function(){var o=function(o){var t=this;this.config=o,this.control=!1,this.sPos={},this.mPos={},this.dire,this.config.bind.addEventListener("touchstart",function(o){return t.start(o)},!1),this.config.bind.addEventListener("touchmove",function(o){return t.move(o)},!1),this.config.bind.addEventListener("touchend",function(o){return t.end(o)},!1)};o.prototype.start=function(o){var t=o.touches?o.touches[0]:o;this.sPos.x=t.screenX,this.sPos.y=t.screenY},o.prototype.move=function(o){o.preventDefault();var t=o.touches?o.touches[0]:o;this.control=!0,this.mPos.x=t.screenX,this.mPos.y=t.screenY},o.prototype.end=function(o){this.mPos.x>this.sPos.x&&this.mPos.x-this.sPos.x>50?this.dire="r":this.mPos.x<this.sPos.x&&this.sPos.x-this.mPos.x>50?this.dire="l":this.mPos.y>this.sPos.y&&this.mPos.y-this.sPos.y>50?this.dire="d":this.mPos.y<this.sPos.y&&this.sPos.y-this.mPos.y>50&&(this.dire="u"),this.control=!1,this.config.backfn(this)},window.LSwiperMaker=o,document.addEventListener("touchmove",function(o){o.preventDefault()},!1)}();var swipe=new LSwiperMaker({bind:document.getElementById("block_container"),backfn:function(o){"l"===o.dire?block.left():"u"===o.dire?block.up():"r"===o.dire?block.right():"d"===o.dire&&block.down()}});$("#start_game,#restart").on("click",function(){block.restart()});